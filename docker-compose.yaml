version: '3.8'

services:
  victim:
    image: alpine:latest
    container_name: victim
    networks:
      - labnet
    cap_add:
      - NET_ADMIN
    command: >
      sh -c "
        apk add --no-cache python3 curl busybox-extras && 
        echo 'Welcome to victim HTTP server!' > /tmp/index.html &&
        python3 -m http.server 80 --bind 0.0.0.0 &
        while true; do sleep 3600; done
      "

  attacker:
    image: kalilinux/kali-rolling:latest
    container_name: attacker
    networks:
      - labnet
    cap_add:
      - NET_ADMIN
    command: tail -f /dev/null  # keep alive

  suricata:
    image: ubuntu/suricata:latest
    container_name: suricata
    privileged: true
    network_mode: host
    volumes:
      - ./suricata.yaml:/etc/suricata/suricata.yaml:ro
      - ./logs:/var/log/suricata
    command: >
      suricata -c /etc/suricata/suricata.yaml -i docker0 --af-packet -l /var/log/suricata

networks:
  labnet:
    driver: bridge